# Deliverables — .live.md

## 1) Executive Summary
Implemented MCP tool adapter stub for lex-pr-runner with `plan.create` tool and read-only resource access to `.smartergpt/runner/` artifacts. Added deterministic `snapshot.md` generation to complement existing `plan.json` output.

## 2) Steps Taken
- Enhanced plan creation logic to generate deterministic `snapshot.md` alongside `plan.json`
- Updated CLI plan command to write both artifacts
- Implemented MCP server using `@modelcontextprotocol/sdk` with:
  - `plan.create` tool that runs the same logic as CLI
  - Resource access to `plan.json` and `snapshot.md` files
  - Security checks for file access
- Added minimal unit tests for plan functionality
- Updated README documentation for MCP functionality
- Verified deterministic artifact generation

## 3) Evidence & Verification

### CLI Plan Command
```bash
$ npm run cli -- plan
Wrote .smartergpt/runner/plan.json
Wrote .smartergpt/runner/snapshot.md
```

### Deterministic Verification
```bash
# First run
$ npm run cli -- plan && md5sum .smartergpt/runner/plan.json .smartergpt/runner/snapshot.md
c2d3bde56bc926e7f1d0ba4082e950a8  .smartergpt/runner/plan.json
66a9bb5e70acfa650e02a56c1ccd090b  .smartergpt/runner/snapshot.md

# Second run (identical checksums)
$ npm run cli -- plan && md5sum .smartergpt/runner/plan.json .smartergpt/runner/snapshot.md
c2d3bde56bc926e7f1d0ba4082e950a8  .smartergpt/runner/plan.json
66a9bb5e70acfa650e02a56c1ccd090b  .smartergpt/runner/snapshot.md
```

### MCP Tool Functionality Test
```javascript
// Testing plan.create tool logic
{
  "success": true,
  "plan": {
    "target": "main",
    "items": []
  },
  "artifacts": {
    "plan.json": {
      "path": "/tmp/test-artifacts/plan.json",
      "uri": "file:///tmp/test-artifacts/plan.json",
      "size": 37
    },
    "snapshot.md": {
      "path": "/tmp/test-artifacts/snapshot.md",
      "uri": "file:///tmp/test-artifacts/snapshot.md",
      "size": 241
    }
  },
  "message": "Generated plan with 0 items targeting main"
}
```

### Unit Tests
```bash
$ npx tsx --test src/test/plan.test.ts
▶ Plan functionality
  ✔ should create a plan with default values (0.724509ms)
  ✔ should generate deterministic snapshot (0.280477ms)
✔ Plan functionality (1.882602ms)
```

### TypeScript Type Checking
```bash
$ npm run typecheck
> lex-pr-runner@0.1.0 typecheck
> tsc -p tsconfig.json
```

## 4) Final Results
**Acceptance Criteria Met: YES**

✅ **Add `plan.create` tool that runs the same logic as CLI**
- Implemented `plan.create` tool in MCP server
- Tool executes identical logic to `npm run cli -- plan`
- Returns plan metadata and URIs to artifacts

✅ **Expose `.smartergpt/runner/{plan.json,snapshot.md}` as read-only resources**
- Both files exposed as MCP resources
- Security checks prevent access outside artifacts directory
- Proper MIME types assigned (application/json, text/markdown)

✅ **Calling `plan.create` yields plan metadata and URIs to artifacts**
- Tool returns structured response with plan data
- Includes URIs to both plan.json and snapshot.md
- Provides file metadata (size, path, URI)

## 5) Files Changed
- **MODIFIED** `src/core/plan.ts`: Added `generateSnapshot()` function
- **MODIFIED** `src/cli.ts`: Updated to generate both plan.json and snapshot.md
- **MODIFIED** `src/mcp/server.ts`: Implemented full MCP server with tools and resources
- **MODIFIED** `README.md`: Updated documentation for MCP functionality
- **ADDED** `src/test/plan.test.ts`: Unit tests for plan functionality
- **ADDED** `.smartergpt/runner/snapshot.md`: Generated artifact
- **MODIFIED** `package.json`: Added @modelcontextprotocol/sdk dependency

All changes are minimal and focused on the specific requirements in the issue.
